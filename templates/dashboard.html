<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Dashboard</title>
    <!-- Material Design Lite CSS -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.min.js"></script>
    <style>
        .mdl-layout__content {
            padding: 24px;
        }
        .mdl-card {
            width: 100%;
            margin-bottom: 24px;
        }
        .mdl-card__title {
            color: #fff;
            background-color: #3f51b5;
        }
        .option-button {
            width: 100%;
            margin: 8px 0;
            text-align: left;
        }
        .response-entry {
            padding: 8px;
            margin: 4px 0;
            background: #f5f5f5;
            border-radius: 4px;
        }
        .correct {
            color: #4CAF50;
        }
        .incorrect {
            color: #F44336;
        }
    </style>
</head>
<body>
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
        <header class="mdl-layout__header">
            <div class="mdl-layout__header-row">
                <span class="mdl-layout-title">Quiz Dashboard</span>
                <div class="mdl-layout-spacer"></div>
                <a href="/" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored">
                    Home
                </a>
            </div>
        </header>
        <main class="mdl-layout__content">
            <div class="mdl-card mdl-shadow--2dp">
                <div class="mdl-card__title">
                    <h2 class="mdl-card__title-text">Question {{ index + 1 }} of {{ total }}</h2>
                </div>
                <div class="mdl-card__supporting-text">
                    <h4>{{ quiz.question }}</h4>
                    <div class="mdl-grid">
                        <div class="mdl-cell mdl-cell--6-col">
                            <button class="mdl-button mdl-js-button mdl-button--raised option-button" onclick="submitAnswer('A')">
                                A. {{ quiz.options.A }}
                            </button>
                            <button class="mdl-button mdl-js-button mdl-button--raised option-button" onclick="submitAnswer('B')">
                                B. {{ quiz.options.B }}
                            </button>
                        </div>
                        <div class="mdl-cell mdl-cell--6-col">
                            <button class="mdl-button mdl-js-button mdl-button--raised option-button" onclick="submitAnswer('C')">
                                C. {{ quiz.options.C }}
                            </button>
                            <button class="mdl-button mdl-js-button mdl-button--raised option-button" onclick="submitAnswer('D')">
                                D. {{ quiz.options.D }}
                            </button>
                        </div>
                    </div>
                </div>
                <div class="mdl-card__actions mdl-card--border">
                    <a href="/next" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored">
                        Next Question
                    </a>
                    <a href="/analysis" class="mdl-button mdl-js-button mdl-button--raised">
                        View Analysis
                    </a>
                </div>
            </div>

            <div class="mdl-card mdl-shadow--2dp">
                <div class="mdl-card__title">
                    <h2 class="mdl-card__title-text">Live Responses</h2>
                </div>
                <div class="mdl-card__supporting-text" id="responseContainer">
                    <!-- Responses will be added here -->
                </div>
            </div>
        </main>
    </div>

    <script>
        const socket = io();
        socket.on('new_response', function(data) {
            const container = document.getElementById('responseContainer');
            const div = document.createElement('div');
            div.className = 'response-entry';
            div.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span class="${data.correct ? 'correct' : 'incorrect'}">
                        ðŸ“˜ ${data.student} selected option ${data.option}
                    </span>
                    <small style="color: #666;">${new Date(data.timestamp).toLocaleTimeString()}</small>
                </div>
                <div style="font-size: 0.9em; color: #666; margin-top: 4px;">
                    Q: ${data.question_text.substring(0, 50)}${data.question_text.length > 50 ? '...' : ''}
                </div>
            `;
            container.prepend(div);
        });

        function submitAnswer(option) {
            const student = prompt('Enter your name:');
            if (student) {
                fetch(`/receive_data?student=${encodeURIComponent(student)}&option=${option}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.error) {
                            alert('Error: ' + data.error);
                        } else {
                            // Show the embedded live response immediately
                            const container = document.getElementById('responseContainer');
                            const div = document.createElement('div');
                            div.className = 'response-entry';
                            div.innerHTML = `
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span class="${data.correct ? 'correct' : 'incorrect'}">
                                        ðŸ“˜ ${data.student} selected option ${data.option}
                                    </span>
                                    <small style="color: #666;">${new Date(data.timestamp).toLocaleTimeString()}</small>
                                </div>
                                <div style="font-size: 0.9em; color: #666; margin-top: 4px;">
                                    Q: ${data.question_text.substring(0, 50)}${data.question_text.length > 50 ? '...' : ''}
                                </div>
                            `;
                            container.prepend(div);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('Error submitting response');
                    });
            }
        }
    </script>
</body>
</html>

